---
layout: post
title: Mac代理相关设置
tags: [MacOS,代理]
categories: [操作系统]
---

## 前言

在公司有代理，所以在公司都是连的公司的代理

回家用的是`clash verge`开代理

然后就混乱了

设置一下两个代理快捷的切换配置

## 终端代理

先搞一下终端的代理配置

### 临时添加

```shell
# company
export http_proxy="http://192.168.0.112:8123"
export https_proxy="http://192.168.0.112:8123"
export socks_proxy="socks://192.168.0.112:1080"
# home
export http_proxy="http://127.0.0.1:7897"
export https_proxy="http://127.0.0.1:7897"
export socks_proxy="socks://127.0.0.1:7897"
```

### 配置别名开启

```bash
# 追加到 ~/.zshrc 或 ~/.bashrc 末尾
proxyon() {
    case "${1:-0}" in
        1)  # company
            export http_proxy="http://192.168.0.112:8123"
            export https_proxy="http://192.168.0.112:8123"
            export socks_proxy="socks://192.168.0.112:1080"
            ;;
        2)  # home clash verge
            export http_proxy="http://127.0.0.1:7897"
            export https_proxy="http://127.0.0.1:7897"
            export socks_proxy="socks://127.0.0.1:7897"
            ;;
        *)
            echo "Usage: proxyon 1|2"
            return 1
            ;;
    esac
    echo "Proxy ON (mode $1)"
}

proxyoff() {
    unset http_proxy https_proxy socks_proxy
    echo "Proxy OFF"
}
```

默认自动开启公司代理

```bash
# 在 ~/.zshrc 再追加一行
echo 'proxyon 1' >> ~/.zshrc
# 在 ~/.bashrc 再追加一行
echo 'proxyon 1' >> ~/.bashrc
# zsh
source ~/.zshrc
# bash
source ~/.bashrc
```

### 脚本快速切换终端代理

20250908更新：

后来设置了快速切换终端默认代理的脚本，如下：

```shell
jay:~ $ cat /usr/local/bin/switch-proxy 
#!/bin/bash

# 检查参数
if [[ "$1" != "1" && "$1" != "2" && "$1" != "0" ]]; then
  echo "Usage: switch-proxy [0|1|2]"
  echo "  0: disable proxy"
  echo "  1: company proxy"
  echo "  2: home proxy"
  exit 1
fi

# 定义要修改的文件列表
FILES=("$HOME/.zshrc" "$HOME/.bash_profile")

for FILE in "${FILES[@]}"; do
  if [[ -f "$FILE" ]]; then
    # 删除旧的 proxyon 和 proxyoff 行
    sed -i.bak '/^# __PROXY_AUTO__$/ {N; d;}' "$FILE"
    # 根据参数添加新的配置
    if [[ "$1" == "0" ]]; then
      echo "# __PROXY_AUTO__" >> "$FILE"
      echo "proxyoff" >> "$FILE"
    else
      echo "# __PROXY_AUTO__" >> "$FILE"
      echo "proxyon $1" >> "$FILE"
    fi
  fi
done

# 自动 source，使当前 shell 立即生效
source ~/.zshrc 2>/dev/null
source ~/.bash_profile 2>/dev/null

echo "Proxy switched to: $1"%   
```

## 非终端的代理快速开启/关闭

在家用clash的话开关非常简单，直接clash里面开关就可以了，这里主要讲下在公司的代理快速开启和关闭：

核心通过终端和快捷指令，实现在菜单栏点击就能开启和关闭代理

### 步骤

打开`快捷指令`

![image-20250815140034897](/assets/images/post/image-20250815140034897.png)

右边找到`终端`-`运行shell脚本`

![image-20250815140145214](/assets/images/post/image-20250815140145214.png)

填命令

```shell
networksetup -setwebproxy "Wi-Fi" 192.168.0.111 6666
networksetup -setsecurewebproxy "Wi-Fi" 192.168.0.112 7777
networksetup -setsocksfirewallproxy "Wi-Fi" 192.168.0.113 8888
echo "已开启代理"
```

关闭的

```shell
networksetup -setwebproxystate "Wi-Fi" off
networksetup -setsecurewebproxystate "Wi-Fi" off
networksetup -setsocksfirewallproxystate "Wi-Fi" off
echo "已关闭代理"
```

最后勾选`在菜单栏中固定`

![image-20250815140505181](/assets/images/post/image-20250815140505181.png)

你可以看到菜单栏出现快捷指令图标点进去就有代理开启和代理关闭的快捷指令

## End

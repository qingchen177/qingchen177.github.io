## 机器学习算法

### KNN

最邻近，找到k个最近的，哪个种类多就我就是哪一类。取决于K的选值和距离计算方式。

k的选值可以用交叉验证

#### 欧式距离

$$
d_{12}=\sqrt{(x_1-x_2)^2+(y_1-y_2)^2}
$$



#### 曼哈顿距离

$$
d_{12}=|x_1-x_2|+|y_1-y_2|
$$


<iframe src="https://www.desmos.com/calculator/imgi4qg9zo?embed" width="500" height="500" style="border: 1px solid #ccc" frameborder=0></iframe>

**红线为欧式距离，绿加蓝为曼哈顿距离**

### 朴素贝叶斯算法

用于概率推测，有稳定的分类效率

##### 拉普拉斯平滑系数

目的：防止计算出的分类概率为0
$$
P(F1|C)=\frac{Ni+\alpha}{N+\alpha m}
\\
\alpha 一般取1，m是特征词个数
$$

### 决策树

if else结构，信息熵，信息增益，找特征权重最大的，树木可视化

### 随机森林

- 用N来表示训练用例（样本）的个数，M表示特征数目。
  - 1、一次随机选出一个样本，重复N次， （有可能出现重复的样本）
  - 2、随机去选出m个特征, m <<M，建立决策树
- 采取bootstrap抽样（有放回的抽样）

### 回归算法

#### 线性回归

$$
y=w_1x_1+w_2x_2+w_3x_3+w_4x_4+...+b=w^T+b
\\
w,x可以理解为矩阵：w = \begin{pmatrix}
b\\
w1\\
w2
\end{pmatrix},
x = \begin{pmatrix}
1\\
x1\\
x2
\end{pmatrix}\\
b是（bias)偏置
$$

##### 损失函数

最小二乘法：
$$
J(\theta)=\textstyle\sum_{i=1}^m(h_w(x_i)-y)^2
$$

##### 优化算法

`正规方程`
$$
w=(X^TX)^{-1}X^Ty
$$
`梯度下降(Gradient Descent)-GD`
$$
w_1=w_1-\alpha\frac{\delta cost(w_0+w_1x_1)}{\delta w_1}
\\
\alpha 为学习速率
$$
`SGD-随机梯度下降`

`SAG-随机平均梯度下降`

##### 回归性能

均方误差
$$
MSE=\frac{1}{m} \textstyle\sum_{i=1}^m(y_i-\overline{y})^2
$$

##### 过拟合、欠拟合

- 过拟合：一个假设在训练数据上能够获得比其他假设更好的拟合， 但是在测试数据集上却不能很好地拟合数据，此时认为这个假设出现了过拟合的现象。(模型过于复杂)

- 欠拟合：一个假设在训练数据上不能获得更好的拟合，并且在测试数据集上也不能很好地拟合数据，此时认为这个假设出现了欠拟合的现象。(模型过于简单)

  > - 欠拟合原因以及解决办法
  >   - 原因：学习到数据的特征过少
  >   - 解决办法：增加数据的特征数量
  >
  > - 过拟合原因以及解决办法
  >   - 原因：原始特征过多，存在一些嘈杂特征， 模型过于复杂是因为模型尝试去兼顾各个测试数据点
  >     - 解决办法：
  >       - 正则化

#### 岭回归

##### 范数

$$
L_p=||x||_p=\sqrt[p]{\textstyle\sum_{i=1}^nx_i^p},X=(x_1,x_2,...,x_n)
$$

**L2范数：表示向量元素的平方和再开平方**

损失函数：`最小二乘法 + L2范数`

#### 逻辑回归（二分类）

##### 输入

输入是一个线性回归的结果
$$
y=w_1x_1+w_2x_2+w_3x_3+w_4x_4+...+b
$$

##### 激活函数

`sigmoid函数`
$$
f(x)=\frac{1}{1+e^{-x}}
$$

- 回归的结果输入到sigmoid函数当中
- 输出结果：[0, 1]区间中的一个概率值，默认为0.5为阈值

##### 损失函数-对数似然损失

逻辑回归的损失
$$
\operatorname{cost}(h_{\theta}(x), y) = \left\{
\begin{array}{ll}
-\log(h_{\theta}(x)) & \text{if } y = 1 \\
-\log(1 - h_{\theta}(x)) & \text{if } y = 0
\end{array}
\right.
$$


##### 优化算法

SGD等

#### 无监督算法 K-means（K均值聚类）

1. 随机设置K个特征空间内的点作为初始的聚类中心
2. 对于其他每个点计算到K个中心的距离，未知的点选择最近的一个聚类中心点作为标记类别
3. 接着对着标记的聚类中心之后，重新计算出每个聚类的新中心点（平均值）
4. 如果计算得出的新中心点与原中心点一样，那么结束，否则重新进行第二步过程

##### 轮廓系数

$$
SC_i=\frac{b_i-a_i}{max(b_i,a_i)}
$$

> 注：对于每个点i 为已聚类数据中的样本 ，b_i 为i 到其它族群的所有样本的距离最小值，a_i 为i 到本身簇的距离平均值。最终计算出所有的样本点的轮廓系数平均值

## 深度学习

### 神经网络

`ANN`或者`NN` ，`Artificial Neural Network`

- 输入层
- 隐藏层
- 全连接层
- 输出层

#### 多层感知机

感知机 == 逻辑回归

激活函数不同

感知机的激活函数是

`sign函数`
$$
u=\textstyle\sum_{i=1}^nw_ix_i+b
\\
y = sign(u) = \begin{cases}
+1, &\text u > 0 \\
-1, &\text u\le 0 \\
\end{cases}
$$
感知机处理，0,1分类问题，一条线划分

多个感知机就可以多条线划分

#### SoftMax回归

$$
softmax(y)_i = \frac{e^{y_i}}{\sum_{j=1}^{n} e^{y_i}}
$$

算出每个类别的概率，解决多分类问题

#### 损失函数

交叉熵损失
$$
Hy'(y)=-\displaystyle\sum_{i}y'_ilog(y_i)
$$


总损失-求平均

#### 优化损失函数

梯度下降,SGD...

### 卷积神经网络

#### 卷积层

提取特征

##### 卷积核

- 卷积核个数
- 卷积核大小
- 卷积核步长
- 卷积核零填充大小

#### 激活层

增加非线性分割能力

激活函数

ReLU
$$
ReLU=max(0,x)
$$
解决梯度消失，计算快

#### 池化层（下采样层）

减少学习参数，降低网络复杂度（最大池化，平均池化）

filter 

#### 全连接层

最后的输出，计算损失

## Transformer

tokens：向量

context size =2048，传入2048token进行训练

temperature:温度，加在softmax函数上，选择更温和
$$
softmax(y)_i = \frac{e^{\frac{y_i}{T}}}{\sum_{j=1}^{n} e^{\frac{y_i}{T}}}
$$




- Embedding matrix：分词量，词表 初始随机，表示为：$$W_E$$,100*50
- Query matrix：$$W_Q$$
- Key matrix：$$W_K$$
- Value matrix：$$W_V$$
- Unembedding matrix：$$W_U$$,50*100

#### 训练一个简单的GPT

##### tokenizer

词本，做词元和向量间的映射

##### 数据集分割

0.9-train

0.1-eval

##### 多头注意力

`self-attention`

query，key，value 线性层

加上下三角掩码矩阵

`proj`

线性层转换

`dropout`

防止过拟合

##### 前馈层

多个线性层

激活函数

dropout

##### Block

把多头注意力和前馈层组合

加上层规范 `layer norm`

加上残差连接

##### Model

`token_embedding_table`：token的参数矩阵

`position_embedding_table`：位置的参数矩阵

加上几个Bolck模块

加上层规范layer norm

加上线性转换为词本的大小概率

## 模型部署

。

## RAG

### 向量模型

用来将文本转成向量格式

### 向量索引/向量 库

存贮向量

查询相似度

返回文本

### prompt问答

retrieverQA

## SFT

数据转向量

配置Lora：选择训练模块，lora 秩 ，dropout的比例

构建peftmodel

设置训练参数：学习率、训练次数

初始化trainer开始训练

## Python

基础语法：

```python
if True:
    pass
else:
    pass

while i < 100:
    i += 1
    
for i in range(0, 10):
    continue
    # break
# file
f = open("text.txt", "r", encoding="UTF-8")
```

etc

### langchain

```python
ChatOpenAI()
ChatPromptTemplate()
HumanMessage,AIMessage,SystemMessage
StructuredOutputParser
ConversationBufferMemory,window,tokenbuffer,summary
chain:LLMChain,SimpleSequentialChain,RouteChain,RetrievalQA
agent:initialize_agent
```



## Java

etc

## 数据库

### CRUD

```mysql
SELECT * FROM `qingchen_basic_web_audit_record` where operator like '-1';
INSERT INTO TABLE_NAME(COLUM1,COLUM2,...) VALUES (VALUE1,VALUE2,...);
UPDATE TABLE_NAME SET COLUM1 = VALUE1 WHERE CONDITION;
DELETE FROM TABLE_NAME WHERE CONDITION;
```

## 容器

### docker

镜像（image）、容器（container）、docker引擎（Docker Engine）、docker hub 云端镜像库

`docker compose`：YAML文件创建运行容器

`docker swarm`：集群部署

`Dockerfile`：自定义镜像

镜像分层技术

```shell
docker build -t name:tag .
docker images
docker ps -a
docker push 
docker pull name:tag
docker run -itd name:tag /bin/bash -p 8080:8080
docker stop containerid
docker start\restart containerid
docker exec -it containerid /bin/bash
docker export containerid > name.tar
docker import
docker rm -f cid
docker rmi iid
docker logs -f cid
docker tag cid name:tag
```



### k8s

```shell
# kubectl get 资源类型

#获取类型为Deployment的资源列表
kubectl get deployments

#获取类型为Pod的资源列表
kubectl get pods

#获取类型为Node的资源列表
kubectl get nodes

# 查看所有名称空间的 Deployment
kubectl get deployments -A
kubectl get deployments --all-namespaces
# 查看 kube-system 名称空间的 Deployment
kubectl get deployments -n kube-system

# kubectl describe 资源类型 资源名称

#查看名称为nginx-XXXXXX的Pod的信息
kubectl describe pod nginx-XXXXXX	

#查看名称为nginx的Deployment的信息
kubectl describe deployment nginx

# kubectl logs Pod名称

#查看名称为nginx-pod-XXXXXXX的Pod内的容器打印的日志
#本案例中的 nginx-pod 没有输出日志，所以您看到的结果是空的
kubectl logs -f nginx-pod-XXXXXXX

# kubectl exec Pod名称 操作命令

# 在名称为nginx-pod-xxxxxx的Pod中运行bash
kubectl exec -it nginx-pod-xxxxxx /bin/bash

kubectl apply -f nginx-service.yaml

kubectl get services -o wide


```



## Linux

```shell
cd
pwd
ls
ll
mkdir
chmod -R 777
chown
cat
tail -f
touch
more
cp
mv
rm
which
find
grep
echo
wc
su
sudo
genent passwd
yum install -y 
systemctl status firewalld
ln -s path1 path2
hostnamectl set-hostname qingchen
curl -sSL
ping ip
wget url
netstat -anp
ps -ef
top
tar -zxvf xxx.tar.gz -C path
tar -zcvf
export env
rz

```


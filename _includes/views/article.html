<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="post-content e-content" itemprop="articleBody">

      {{ content }}

    </div>

</article>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const container = document.querySelector(".post-content");
  if (!container) return;

  // æ­£åˆ™è¯†åˆ« URLï¼ˆæ”¯æŒ https å’Œ www. å¼€å¤´ï¼‰
  const urlRegex = /(?:https?:\/\/|www\.)[^\s<>"'`ï¼Œã€‚ï¼ï¼Ÿï¼›ï¼šã€ã€ã€‘ã€Œã€ã€ã€ï¼ˆï¼‰()ã€Šã€‹]*[^\s<>"'`ï¼Œã€‚ï¼ï¼Ÿï¼›ï¼šã€ã€ã€‘ã€Œã€ã€ã€ï¼ˆï¼‰()ã€Šã€‹.]/g;

  // éå† container ä¸­çš„æ‰€æœ‰æ–‡æœ¬èŠ‚ç‚¹ï¼ˆä¸åŒ…æ‹¬ a æ ‡ç­¾å†…ï¼‰
  const walker = document.createTreeWalker(container, NodeFilter.SHOW_TEXT, {
    acceptNode: (node) => {
      // æ’é™¤å·²ç»åœ¨ <a> æ ‡ç­¾å†…çš„æ–‡æœ¬èŠ‚ç‚¹
      return node.parentNode.nodeName === "A" ? NodeFilter.FILTER_REJECT : NodeFilter.FILTER_ACCEPT;
    }
  });

  const textNodes = [];
  while (walker.nextNode()) {
    textNodes.push(walker.currentNode);
  }

  for (const node of textNodes) {
    const text = node.nodeValue;
    const replaced = text.replace(urlRegex, function (rawUrl) {
      const href = rawUrl.startsWith('www.') ? 'https://' + rawUrl : rawUrl;
      return `<a href="${href}" target="_blank" rel="noopener">${rawUrl}</a>`;
    });

    // å¦‚æœæœ‰æ›¿æ¢å†…å®¹ï¼Œæ›¿æ¢ä¸º HTML èŠ‚ç‚¹
    if (replaced !== text) {
      const span = document.createElement("span");
      span.innerHTML = replaced;
      node.parentNode.replaceChild(span, node);
    }
  }
});
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('pre').forEach(pre => {
      const code = pre.querySelector('code');

      if (!code) {
        console.warn('å‘ç°æ²¡æœ‰ <code> çš„ <pre> å…ƒç´ ï¼Œå·²è·³è¿‡æ·»åŠ å¤åˆ¶æŒ‰é’®');
        return;
      }

      const copyBtn = document.createElement('button');
      copyBtn.className = 'copy-btn';
      copyBtn.type = 'button';
      copyBtn.textContent = 'ğŸ“‹';

      pre.appendChild(copyBtn);

      copyBtn.addEventListener('click', () => {
        const text = code.innerText;

        // å°è¯•ä½¿ç”¨ Clipboard APIï¼ˆç°ä»£æµè§ˆå™¨ï¼‰
        if (navigator.clipboard) {
          navigator.clipboard.writeText(text)
            .then(() => {
              copyBtn.textContent = 'âœ…';
              setTimeout(() => {
                copyBtn.textContent = 'ğŸ“‹';
              }, 2000);
            })
            .catch(err => {
              console.error('Clipboard API å¤±è´¥:', err);
              fallbackCopyText(text, copyBtn);
            });
        } else {
          // å›é€€åˆ° execCommand
          fallbackCopyText(text, copyBtn);
        }
      });
    });

    // å…¼å®¹æ–¹æ³•ï¼šä½¿ç”¨ textarea + execCommand
    function fallbackCopyText(text, button) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.opacity = '0';
      document.body.appendChild(textarea);
      textarea.select();
      try {
        const successful = document.execCommand('copy');
        if (successful) {
          button.textContent = 'âœ…';
          setTimeout(() => {
            button.textContent = 'ğŸ“‹';
          }, 2000);
        } else {
          alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å†…å®¹åæŒ‰ Ctrl+C');
        }
      } catch (err) {
        alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å†…å®¹åæŒ‰ Ctrl+C');
        console.error('execCommand å¤±è´¥:', err);
      }
      document.body.removeChild(textarea);
    }
  });
</script>
